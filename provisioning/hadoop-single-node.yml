---
- hosts: all
  tasks:
    - name: Add the Java 8 repository
      sudo: yes
      apt_repository: repo="deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" update_cache=yes state=present

    - name: Add the Java 8 source repository
      sudo: yes
      apt_repository: repo="deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" update_cache=yes state=present

    - name: Add the key
      sudo: yes
      apt_key: keyserver="keyserver.ubuntu.com" id="EEA14886" state=present

    - name: Add webupd8team repository
      sudo: yes
      apt_repository: repo="ppa:webupd8team/java" update_cache=yes state=present

    - name: Deal with Oracle Java 8 Licensing Bullshit
      sudo: yes
      shell: "echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections"

    - name: Ensure packages setup and ready
      sudo: yes
      apt:  name={{item}} state=present update_cache=yes
      with_items:
        - ssh
        - rsync
        - oracle-java8-installer
        - oracle-java8-set-default

    - name: Get Hadoop 2.7.1 release from remote servers
      get_url: url="http://www.us.apache.org/dist/hadoop/common/hadoop-2.7.1/hadoop-2.7.1.tar.gz" dest="/tmp/hadoop-2.7.1.tar.gz"

    - name: Untar the Hadoop release
      sudo: yes
      unarchive: src="/tmp/hadoop-2.7.1.tar.gz" dest="/usr/local/lib/" copy=no

    - name: Copy hadoop core-site xml file
      sudo: yes
      template: src="templates/usr/local/lib/hadoop-2.7.1/etc/hadoop/{{item}}.j2"  dest="/usr/local/lib/hadoop-2.7.1/etc/hadoop/{{item}}" mode="0644"
      with_items:
        - core-site.xml
        - hdfs-site.xml